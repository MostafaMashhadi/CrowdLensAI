# CrowdLens | AI-powered People Counting & Crowd Analytics

**Author:** Mostafa Mashhadizadeh   
**Affiliation:** Shiraz University of Technology  
**Contact:** mashhadizademostafa@gmail.com  

CrowdLens AI is a real-time crowd analytics system designed for public spaces such as offices, shopping malls, metro stations, and events.  
It uses **YOLOv10** for detection and **ByteTrack + Re-ID** for stable person identity tracking, even during occlusions or reappearances.  
This repository includes **pre-tuned models and hyperparameters** for reliable, out-of-the-box performance.

---

## Processed Video Example

Below is a playable example of the output generated by CrowdLens AI, showing stable tracking and counting:

<p align="center">
  <a href="outputs/demo.gif">
    <img src="outputs/demo.gif" alt="CrowdLens AI Demo" width="800">
  </a>
</p>

---

## Features

- **People Counting** – Tracks unique individuals in the scene.
- **Robust Tracking** – Maintains stable IDs across occlusions via two-layer ID mapping.
- **Re-identification (Re-ID)** – Integrates `osnet_x1_0_msmt17.pth` for appearance-based matching.
- **Pre-Tuned Models** – Optimal YOLOv10 and tracker parameters for Mac M-series defaults.
- **Real-Time Processing** – Supports webcam, CCTV, or video file sources.
- **JSON Output** – Saves structured tracking data alongside processed video.
- **Configurable Parameters** – Thresholds and settings editable via `config.yaml` and `bytetrack.yaml`.

---

## Project Structure
```
CrowdLensAI/
├── models/                # YOLO & Re-ID models (yolov10s.pth, osnet_x1_0_msmt17.pth)
├── data/                  # Test videos (test.mp4)
├── outputs/               # Processed videos and JSON output files
├── src/
│   ├── main.py             # Main execution script
│   ├── detector.py         # YOLOv10 detection wrapper
│   ├── tracker.py          # ByteTrack + Re-ID tracker
│   ├── utils.py            # Utility functions
│   ├── config.yaml         # Detection & tracker configuration
│   └── bytetrack.yaml      # ByteTrack-specific settings
├── requirements.txt
└── README.md
```

---

## Installation

Tested on macOS (Apple M-series, Python 3.12).  
Supports CPU, CUDA, and MPS backends.

```bash
# Clone the repository
git clone https://github.com/MostafaMashhadi/CrowdLensAI.git
cd CrowdLensAI

# Create and activate virtual environment
python3 -m venv venv
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt
```

---

## Usage

### Run with the test video (default in `config.yaml`)
```bash
python src/main.py
```

### Run with webcam or CCTV feed
Edit `stream_source` in `src/config.yaml`:
```yaml
stream_source: 0
```
Then:
```bash
python src/main.py
```

---

## Configuration

- **`src/config.yaml`** – Controls detection model, thresholds, source, device.
- **`src/bytetrack.yaml`** – Controls tracker behavior (track buffer, match thresholds, etc.).

Defaults are tuned for Mac M-series and provided models,  
but adjustments may improve performance for specific environments and devices.

---

## Outputs

The system saves results to `outputs/`:
- **MP4 video** – Annotated with bounding boxes, person IDs, and count overlay.
- **JSON file** – Secend-by-secend metadata with tracked IDs and bounding boxes.

---

## Test Video Attribution

The test video used in this project is:

**Yokohama, Japan – March 18, 2023, Minatomirai Station at Yokohama, Japan**,  
uploaded by *Jatsada Wakayaban* on [Vecteezy.com](https://www.vecteezy.com).  
This video is used here for demonstration purposes only under the license provided by Vecteezy.  

## Notes
- Models are pre-configured for optimal performance on the included `test.mp4`.
- For real deployments (e.g., metro stations, malls), re-tuning parameters can improve accuracy.
- Supports YOLOv10s for detection and `osnet_x1_0_msmt17.pth` for Re-ID.

---

## License

This project is licensed under the MIT License.
